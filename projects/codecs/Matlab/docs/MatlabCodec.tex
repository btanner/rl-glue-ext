\documentclass[11pt]{article}

\usepackage{graphics}
\usepackage{url}
\usepackage{verbatim}
\usepackage{fullpage}
\usepackage{html}
%I don't like my paragraphs indented because we have lots of 1-line paragraphs with URLs or code after them
\setlength{\parindent}{0in} 
%I like space between my paragraphs
\setlength{\parskip}{10pt} 

\title{RL-Glue Matlab Codec 1.0 Manual }
\author{Brian Tanner}
\date{}                                        

\begin{document}
\maketitle
\tableofcontents

\section{Introduction}

This document describes how to use the Matlab RL-Glue Codec, a software library that provides socket-compatibility with the RL-Glue Reinforcement Learning software library.  Matlab is a brand new codec, created specifically for the RL-Glue 3.0 release.  Special thanks (or pokes) should go to Dale and Doina who gave voices to the countless others who probably
have scorned us for not supporting Matlab earlier.  It turned out to not even be that difficult :)

For general information and motivation about the RL-Glue\footnote{\url{http://glue.rl-community.org/}} project, please refer to the documentation provided with that project.

This codec will allow you to create agents, environments, and experiment programs in Matlab.

This software project is licensed under the Apache-2.0\footnote{\url{http://www.apache.org/licenses/LICENSE-2.0.html}} license. We're not lawyers, but our intention is that this code 
should be used however it is useful.  We'd appreciate to hear what you're using it for, and to get credit if appropriate.

This project has a home here:\\
\url{http://rl-glue-ext.googlecode.com}


\subsection{Software Requirements}
To run agents, environments, and experiments created with this codec, you will need to have RL-Glue installed on your computer.

Compiling and running components with this codec requires Matlab.  You will also need to have the \htmladdnormallink{RL-Glue Java Codec}{http://glue.rl-community.org/Home/Extensions/java-codec} on your computer, this Matlab codec uses
the Java codec's network capabilities.

\textbf{Possible Contribution: }Someone with Matlab experience could help us find out what version of Matlab is required to use this codec, and could help us update the codec
to be as robust as possible to older versions.

\subsection{Getting the Codec}
The codec can be downloaded either as a tarball or can be checked out of the subversion repository where it is hosted.

The tarball distribution can be found here:\newline
\url{http://code.google.com/p/rl-glue-ext/downloads/list}


To check the code out of subversion:\newline
\small \texttt{svn checkout http://rl-glue-ext.googlecode.com/svn/trunk/projects/codecs/Matlab Matlab-Codec} \normalsize

\subsection{Installing the Codec}
There is no real ``installation'' for the codec per-se.  In each Matlab session, you'll have to add the codec source files to your Matlab path

To add the Matlab codec source files to your path, and to add the Java codec to your Matlab Java path, I do the following:
Matlab will want to know where the codec source files are, so we'll frequently use code like:
\begin{verbatim}
	>> clear java;
	>> javaaddpath('/path/to/my/java/codec/products/JavaRLGlueCodec.jar')
	>> addpath(sprintf('%s%s',pwd(),'/to/matlab/codec/src/glue'));
	>> addpath(sprintf('%s%s',pwd(),'/to/matlab/codec/src/agent'));
	>> addpath(sprintf('%s%s',pwd(),'/to/matlab/codec/src/environment'));
\end{verbatim}

You can make your life easier by writing a script that does this.  There is probably also a way to put these things in your default paths.

\textbf{POSSIBLE CONTRIBUTION}: IF someone wants to investigate the options for having a script ``install'' the Matlab modules into a system classpath, or anything else
to make this more convenient, we would like to have your help!

\section{Gotchas!}
\subsection{Disconnect your Agent/Environment/Experiment}
If your agent/environment/experiment crashes or terminates prematurely, and the \texttt{rl\_glue} executable socket server is still running on your machine, you should
manually disconnect your Matlab component so that the \texttt{Java} socket gets cleaned up.  Depending on what you were running, the code would be:
\begin{verbatim}
	>> disconnectAgent()                 %For agents
	>> disconnectEnvironment()           %For environments
	>> disconnectGlue()                  %For experiments
\end{verbatim}

If you don't disconnect manually in these cases, Matlab can get hung up and you'll have to restart it.

\subsection{One Component At A Time}
Matlab is inherently single threaded, so without making the codec overly complicated, we had to limit each Matlab instance to running a single component at at time.
This means that you can only run ONE of an agent OR environment OR experiment in Matlab at a time.  If you know how to open multiple Matlab instances (not sure if this is possible), you can run one
component per instance.  We think that the usual case will probably be to run your agent in Matlab, but run the experiment and environment in another language, like Java, C, or Python.

We may lift this restriction in the future, or write a local glue engine so that all three can run together inside Matlab.

\section{Agents}
\label{sec:agent}
We have provided a skeleton agent with the codec that is a good starting point for agents that you may write in the future.
It implements all the required functions and provides a good example of how create and run a simple agent.

The pertinent file is:
\begin{verbatim}
	examples/skeleton_agent/skeleton_agent_construct.m
	examples/skeleton_agent/skeleton_agent_init.m
	examples/skeleton_agent/skeleton_agent_start.m
	examples/skeleton_agent/skeleton_agent_step.m
	examples/skeleton_agent/skeleton_agent_message.m
	examples/skeleton_agent/skeleton_agent_end.m
	examples/skeleton_agent/skeleton_agent_cleanup.m
\end{verbatim}

You may realize that this feels like many files to create a simple agent. You're right.  Usually, in Matlab, it's important to have each of your public functions in a separate file 
so that you can easily call the functions from the global Matlab scope.  In Section \ref{sec:env} we'll show how you can create agents and environments using a single file because of 
our function pointer strategy.


This agent does not learn anything and randomly chooses integer action $0$ or $1$.  

You can compile and run the agent like:
\begin{verbatim}
	>$ cd examples/skeleton_agent/
	>$ theAgent=skeleton_agent_construct();
	>$ runAgent(theAgent);
\end{verbatim}

\htmladdnormallink{\texttt{skeleton\_agent\_construct()}}{http://code.google.com/p/rl-glue-ext/source/browse/trunk/projects/codecs/Matlab/examples/skeleton\_agent/skeleton\_agent\_construct.m} creates a struct with function pointers to the other \texttt{skeleton\_agent} methods.  \htmladdnormallink{\texttt{runAgent(theAgent)}}{http://code.google.com/p/rl-glue-ext/source/browse/trunk/projects/codecs/Matlab/src/agent/runAgent.m} then
connects to RL-Glue and runs one step at a time until RL-Glue disconnects.

Alternatively, for a more interactive experience, you can run the agent manually one step at a time:
\begin{verbatim}
	>$ cd examples/skeleton_agent/
	>$ theAgent=skeleton_agent_construct()
	>$ connectAgent(theAgent);
	>$ runAgentLoop(theAgent);    %run one step
	>$ runAgentLoop(theAgent);    %run one step
	>$ runAgentLoop(theAgent);    %run one step
	   ...
\end{verbatim}

Using this method, you can stop and examine what your agent is learning, and potentially modify, visualize, or analyze it however you like.

You will see something like:
\begin{verbatim}
	>> runAgent(theAgent)
	RL-Glue Matlab Agent Codec Version: 1.0 ($Revision$)
	    Connecting to rl_glue at host: localhost on port 4096
\end{verbatim}

This means that the skeleton\_agent is running, and trying to connect to the \texttt{rl\_glue} executable server on the local machine through port $4096$! 

You can kill the process by pressing \texttt{CTRL-c} on your keyboard, and then starting  \texttt{rl\_glue} on your local machine (this will cause Matlab to come back from Java, and 
process your kill command).  Don't forget to \texttt{disconnectAgent()}.

We're sorry that killing an agent (or environment) is so kludgy.  This is the first version of the Matlab codec, so there are some kinks to get out.  We welcome your expertise in helping 
make this codec better!

The Skeleton agent is very simple and well documented, so we won't spend any more time talking about it in these instructions.
Please open it up and take a look.

\textbf{POSSIBLE CONTRIBUTION}: If you take a look at the agent and you think it's not easy to understand, think it could be better documented, 
or just that it should do some fancier things, let us know and we'll be happy to do it!


\section{Environments}
\label{sec:env}

We have provided a skeleton environment with the codec that is a good starting point for environments that you may write in the future.
It implements all the required functions and provides a good example of how to compile a simple environment.  This section will follow the same 
pattern as the agent version (Section \ref{sec:agent}).  This section will be less detailed because many ideas are similar or identical.


The pertinent file is:
\begin{verbatim}
	examples/skeleton_environment/skeleton_environment.m
\end{verbatim}

This environment is episodic, with 21 states, labeled $\{0, 1,\ldots,19,20\}$. States $\{0, 20\}$ are terminal and return rewards of $\{-1, +1\}$ respectively.  The other states return reward of $0$.
There are two actions, $\{0, 1\}$.  Action $0$ decrements the state number, and action $1$ increments it. The environment starts in state 10.

You can compile and run the environment like:
\begin{verbatim}
	>$ cd examples/skeleton_environment
	>$ theEnv=skeleton_environment();
	>$ runEnvironment(theEnv);
\end{verbatim}

You will see something like:
\begin{verbatim}
	RL-Glue Matlab Environment Codec Version: 1.0 ($Revision$)
	    Connecting to rl_glue at host: localhost on port 4096
	\end{verbatim}

This means that the skeleton\_environment is running, and trying to connect to the \texttt{rl\_glue} executable server on the local machine through port $4096$! 

You can kill the process by pressing \texttt{CTRL-c} on your keyboard, and then starting  \texttt{rl\_glue} on your local machine (this will cause Matlab to come back from Java, and 
process your kill command).  Don't forget to \texttt{disconnectEnvironment()}.

The Skeleton environment is very simple and well documented, so we won't spend any more time talking about it in these instructions.
Please open it up and take a look.

\textbf{POSSIBLE CONTRIBUTION}: If you take a look at the environment and you think it's not easy to understand, think it could be better documented, 
or just that it should do some fancier things, let us know and we'll be happy to do it!


\section{Experiments}
We have provided a skeleton experiment with the codec that is a good starting point for experiment that you may write in the future.
It implements all the required functions and provides a good example of how to compile a simple experiment.  This section will follow the same 
pattern as the agent version (Section \ref{sec:agent}).  This section will be less detailed because many ideas are similar or identical.

The pertinent files are:
\begin{verbatim}
	examples/skeleton_experiment/skeleton_experiment.m
\end{verbatim}

This experiment runs \texttt{RL\_Episode} a few times, sends some messages to the agent and environment, and then steps through one episode using \texttt{RL\_step}.

\begin{verbatim}
	>$ cd examples/skeleton
	>$ skeleton_experiment();
\end{verbatim}

You will see something like:
\begin{verbatim}
	Experiment starting up!
	RL-Glue Matlab Experiment Codec Version: 1.0 ($Revision$)
	    Connecting to rl_glue at host: 127.0.0.1 on port 4096
\end{verbatim}

This means that the skeleton\_experiment is running, and trying to connect to the \texttt{rl\_glue} executable server on the local machine through port $4096$!  

You can kill the process by pressing \texttt{CTRL-c} on your keyboard, and then starting  \texttt{rl\_glue} on your local machine (this will cause Matlab to come back from Java, and 
process your kill command).  Don't forget to \texttt{disconnectGlue()}.

The Skeleton experiment is very simple and well documented, so we won't spend any more time talking about it in these instructions.
Please open it up and take a look.

\textbf{POSSIBLE CONTRIBUTION}: If you take a look at the experiment and you think it's not easy to understand, think it could be better documented, 
or just that it should do some fancier things, let us know and we'll be happy to do it!

\section{Putting it all together}
At this point, we've run each of the three components, now it's time to run them with the \texttt{rl\_glue} executable server.  As mentioned elsewhere in this document, in Matlab we can 
only run ONE of the agent, experiment, or environment at a time.  So, for this example we'll run the \texttt{Java SkeletonAgent} and \texttt{Java SkeletonEnvironment} with the \texttt{Matlab skeleton\_experiment}.  You could really run any agent and environment of your choice.

The following will work if you have RL-Glue installed in the default location, and the Java codec downloaded and saved to the location described in the Java codec manual.

For this, we'll use a separate terminal window in addition to the Matlab interpreter.  In a separate terminal window, do:
\begin{verbatim}
	>$ cd /path/to/Java/codec/examples/skeleton
	>$ rl_glue &
	>$ java -classpath ~/JavaCodec/JavaRLGlueCodec.jar:. SkeletonAgent &
	>$ java -classpath ~/JavaCodec/JavaRLGlueCodec.jar:. SkeletonEnvironment &
\end{verbatim}

In the Matlab interpreter:
\begin{verbatim}
	>$ cd examples/skeleton_experiment
	>$ skeleton_experiment();
\end{verbatim}

If RL-Glue is not installed in the default location, you'll have to start the \texttt{rl\_glue} executable server using it's full path (unless it's in your \texttt{PATH} environment variable):
\begin{verbatim}
	>$ /path/to/rl-glue/bin/rl_glue &
\end{verbatim}

In the Matlab window, you should see the following if it worked:
\begin{verbatim}
	>> skeleton_experiment()
	Experiment starting up!
	RL-Glue Matlab Experiment Codec Version: 1.0 ($Revision$)
	    Connecting to rl_glue at host: 127.0.0.1 on port 4096
	    Experiment Codec Connected
	RL_init called, the environment sent task spec: 2:e:1_[i]_[0,20]:1_[i]_[0,1]:[-1,1]


	----------Sending some sample messages----------
	Agent responded to 'what is your name?' with: my name is skeleton_agent, Java edition!
	Agent responded to 'If at first you do't succeed; call it version 1.0  ' 
	with: I don't know how to respond to your message

	Environment responded to 'what is your name?' with: my name is skeleton_environment, Java edition!
	Environment responded to 'If at first you don't succeed; call it version 1.0  ' 
	with: I don't know how to respond to your message


	----------Running a few episodes----------
	Episode 0	 10 steps 	 -1.000000 total reward	 natural end 1
	Episode 1	 10 steps 	 -1.000000 total reward	 natural end 1
	Episode 2	 10 steps 	 -1.000000 total reward	 natural end 1
	Episode 3	 10 steps 	 -1.000000 total reward	 natural end 1
	Episode 4	 10 steps 	 -1.000000 total reward	 natural end 1
	Episode 5	 1 steps 	 0.000000 total reward	 natural end 0
	Episode 6	 10 steps 	 -1.000000 total reward	 natural end 1


	----------Stepping through an episode----------
	First observation and action were: 10 and: 0


	----------Summary----------
	It ran for 10, total reward was: -1.000000
\end{verbatim}


\section{Who creates and frees memory?}
The RL-Glue technical manual has a section called \textit{Who creates and frees memory?}.  The general approach recommended there is to make a copy of data
you want to keep beyond the method it was given to you.  The same rules of thumb from that manual should be followed when using the Matlab codec.


\section{Advanced Features}
This section will explain how to set custom target IP addresses (to connect over the network) and custom ports (to run multiple experiments on one machine or to avoid firewall issues).

Someone should write this later (Opportunity to contribute!).

\section{Codec Specification Reference}
This section will explain how the RL-Glue types and functions are defined for this codec.  This isn't meant to be the most exciting section of this document, but it will
be handy.

Instead of re-creating information that is readily available in the MatlabDocs, we will give pointers were appropriate.

\subsection{Types}


\subsubsection{Simple Types}
Unlike the C/C++ codec, we will not be using \texttt{typedef} statements to create special labels for the types. Since Matlab is loosely typed, these things aren't so hard and 
fast:
\begin{itemize}
	\item \textit{reward} is \texttt{double}
	\item \textit{terminal} is \texttt{int} (1 for terminal, 0 for non-terminal) We hope to replace these with boolean eventually.
	\item \textit{messages} come as Java \texttt{strings} and can be returned as Matlab strings
	\item \textit{task specifications} come as Java \texttt{strings} and can be returned as Matlab strings
\end{itemize}

\def\rat{RL\_Abstract\_Type}

\subsubsection{Structure Types}
\label{sec:structure-types}
All of the major structure types (observations, actions, random seed keys, and state keys) come off the network as the appropriate object from the Java codec.
The \htmladdnormallink{Java codec manual}{http://glue.rl-community.org/Home/Extensions/java-codec} should have all the information required to understand those objects.

So in a given Matlab method, like \newline
\texttt{function theAction=skeleton\_agent\_step(theReward, theObservation)}, 
\texttt{theObservation} is actually of type: \texttt{org.rlcommunity.rlglue.codec.types.Observation}.

Java and Matlab play very well together, so you can do things like:
\begin{verbatim}
	>> testObs=org.rlcommunity.rlglue.codec.types.Observation();
	>> testObs.intArray=[1 2 3 4];
	>> testObs.doubleArray=[0.1 0.5];
	>> testObs.charArray='fun things!';
	>> testObs.toString()

	ans =

	numInts: 4
	numDoubles: 2
	numChars: 11
	 1 2 3 4 0.1 0.5 f u n   t h i n g s !
\end{verbatim}

\subsection{Functions}
\subsubsection{Agent Functions}
All agent constructor functions \textbf{should set} the same functions as our \htmladdnormallink{Skeleton agent}{http://code.google.com/p/rl-glue-ext/source/browse/trunk/projects/codecs/Matlab/examples/skeleton_agent/skeleton_agent_construct.m}.

Useful utility methods for connecting, disconnecting, and running with the \texttt{rl\_glue} executable server are in the \htmladdnormallink{\texttt{agent}}{http://code.google.com/p/rl-glue-ext/source/browse/trunk/projects/codecs/Matlab/src/agent} directory of the Matlab codec source.

\subsubsection{Environment Functions}
All environment constructor functions \textbf{should set} the same functions as our \htmladdnormallink{Skeleton environment}{http://code.google.com/p/rl-glue-ext/source/browse/trunk/projects/codecs/Matlab/examples/skeleton_environment/skeleton_environment.m}.

Useful utility methods for connecting, disconnecting, and running with the \texttt{rl\_glue} executable server are in the \htmladdnormallink{\texttt{environment}}{http://code.google.com/p/rl-glue-ext/source/browse/trunk/projects/codecs/Matlab/src/environment} directory of the Matlab codec source.

\subsubsection{Experiments Functions}
All experiments \textbf{can call} the methods in the  \htmladdnormallink{\texttt{glue}}{http://code.google.com/p/rl-glue-ext/source/browse/trunk/projects/codecs/Matlab/src/glue} directory.
In this case we'll include their prototypes, because the source file is full of implementation details.


\section{Frequently Asked Questions}
We're waiting to hear your questions!

\section{Credits and Acknowledgements}
Brian Tanner wrote the Matlab codec. Yay me.


\subsection{Contributing}
If you would like to become a member of this project and contribute updates/changes to the code, please send a message to rl-glue@googlegroups.com.


\section*{Document Information}
\begin{verbatim}
Revision Number: $Rev$
Last Updated By: $Author$
Last Updated   : $Date$
$URL$
\end{verbatim}

\end{document} 